[[servlet-authentication-daoauthenticationprovider]]
= DaoAuthenticationProvider

{security-api-url}org/springframework/security/authentication/dao/DaoAuthenticationProvider.html[`DaoAuthenticationProvider`] 是  <<servlet-authentication-authenticationprovider,`AuthenticationProvider`>> 实现，它利用  <<servlet-authentication-userdetailsservice,`UserDetailsService`>>  和 <<servlet-authentication-password-storage,`PasswordEncoder`>> 对用户名和密码进行身份验证。

让我们看一下 `DaoAuthenticationProvider` 在Spring Security中的工作方式。 该图详细说明了 <<servlet-authentication-unpwd-input,Reading the Username & Password>>中的  <<servlet-authentication-authenticationmanager,`AuthenticationManager`>>  如何工作。

.`DaoAuthenticationProvider` Usage
image::{figures}/daoauthenticationprovider.png[]

image:{icondir}/number_1.png[] <<servlet-authentication-unpwd-input,读取用户名和密码>>后的身份验证筛选器会将 `UsernamePasswordAuthenticationToken` 传递给 <<servlet-authentication-providermanager,`ProviderManager`>> 所实现的 `AuthenticationManager`。

image:{icondir}/number_2.png[] `ProviderManager` 配置为使用 `DaoAuthenticationProvider` 类型的 <<servlet-authentication-authenticationprovider,AuthenticationProvider>>。

image:{icondir}/number_3.png[] `DaoAuthenticationProvider` 从 `UserDetailsService` 查找 `UserDetails`。

image:{icondir}/number_4.png[] 然后 `DaoAuthenticationProvider` 使用 <<servlet-authentication-password-storage,`PasswordEncoder`>>  来验证上一步返回的 `UserDetails` 上的密码。

image:{icondir}/number_5.png[] 身份验证成功后，返回的<<servlet-authentication-authentication,`Authentication`>>  类型为UsernamePasswordAuthenticationToken，其主体为配置的 `UserDetailsService` 返回的 `UserDetails`。 最终，将通过身份验证筛选器在 <<servlet-authentication-securitycontextholder,`SecurityContextHolder`>>  上设置返回的 `UsernamePasswordAuthenticationToken`。
