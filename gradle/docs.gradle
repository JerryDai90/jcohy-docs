
ext{
	language = "zh-cn"
	component = project.name
	version = project.version
}
configurations {
	asciidoctorExt
}

dependencies {
	asciidoctorExt("io.spring.asciidoctor:spring-asciidoctor-extensions:0.2.0.RELEASE")
}

task extractDocResources(type: Copy) {
	from "${rootDir}/spring-docs-build/src/main/resources"
	into "$buildDir/docs/spring-docs-resources"
}

asciidoctorj {
	modules {
		pdf {
			version '1.5.0-beta.8'
		}
	}
}

asciidoctor {
	baseDir "${sourceDir}/${language}"
	configurations 'asciidoctorExt'
	sources {
		include "${language}/*.adoc"
	}
	outputDir "$buildDir/docs/ref-docs/"
	resources {
		from(sourceDir) {
			include "${language}/images/*"
		}
	}
	logDocuments = true

	outputs.upToDateWhen { false }
	outputOptions {
		backends = ["html5", "pdf"]
	}

	options doctype: 'book', eruby: 'erubis'
	attributes([
			// base attributes
			'idprefix' : "",
			'idseparator' : "-",
			'toc' : "left",
			'toclevels' : 4,
			'tabsize' : 4,
			'numbered' : "",
			'source-indent':0,
			'sectanchors' : "",
			'sectnums' : "",
			'icons' : "font",
			'hide-uri-scheme' : "font",
			'docinfo':"shared,private",
			'highlightjs-theme': "github",
			'highlightjsdir' : "http://resources.jcohy.com/js/highlight",
			'sourceHighlighter' : "highlight.js",
			'stylesdir': "$buildDir/docs/spring-docs-resources/css",
			'stylesheet' : "stylesheet.css",


			// resource attributes
			'resourceDir' : "./spring-docs-build/src/main/resources/",
			'sources-root':"${project.projectDir}/src",
			'spring-data-commons-docs' : "${rootDir}/spring-data/spring-data-commons/src/docs/asciidoc/zh-cn",

			// version attributes
			'spring-framework-version' : "${springVersion}",
			'spring-boot-version' : "${springBootVersion}",
			'spring-data-jpa-version' : "${springDataJpaVersion}",
			'spring-data-redis-version' : "${springDataRedisVersion}",
			'spring-data-rest-version' : "${springDataRestVersion}",
			'spring-data-commons-version' : "${springDataCommonsVersion}",
			'spring-security-version' : "${springSecurityVersion}",
			'spring-hateoas-version' : "${springHateoasVersion}",
			'spring-cloud-version' : "${springCloudVersion}",
			'spring-integration-version' : "${springIntegrationVersion}",
			'spring-webservices-version' : "${springWebservicesVersion}",



			// docs attributes
			'doc-root' : "${docsRoot}",
			'spring-docs-prefix' : "https://docs.spring.io/spring-framework/docs/",
			'spring-boot-docs' : "https://docs.spring.io/spring-boot/docs/'${springBootVersion}'",

			'spring-framework-docs' : "${docsRoot}/zh-cn/spring-framework/${springVersion}/spring-framework-reference/index.html",

			// api attributes

			// sample attributes
			'gh-samples-url':"https://github.com/spring-projects/spring-security/tree/${springSecurityVersion}/samples",
	])
}

asciidoctor.dependsOn extractDocResources

task docsCopy(type: Copy,dependsOn:asciidoctor ) {
	from "$asciidoctor.outputDir"
	into "${rootDir}/build/docs/${component}/${version}"
}

//docsCopy.dependsOn asciidoctor