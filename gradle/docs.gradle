apply plugin: "org.asciidoctor.jvm.convert"

buildscript {
	ext.springComponents = ["spring-data-commons","spring-data-redis","spring-data-rest"]
	ext.component = "spring-data-redis"
}

configurations {
	asciidoctorExt
}

dependencies {
	asciidoctorExt("io.spring.asciidoctor:spring-asciidoctor-extensions:0.2.0.RELEASE")
}

//ext.springComponents = ["spring-data-commons","spring-data-redis","spring-data-rest"]

task docs(){
    springComponents.each { component ->
        ext.component = component
//		asciidoctor.dependsOn(asciidoctor)
//        println("i = ")
//		tasks.asciidoctor.processAsciidocSources
    }
}

ext{

	springComponents
	language = "zh-cn"
//	component = project.name
}

asciidoctorj {
	modules {
		pdf {
			version '1.5.0-beta.8'
		}
	}
}


asciidoctor {
	baseDir "${sourceDir}/${language}/${component}"
	configurations 'asciidoctorExt'
	sources {
		include "${language}/${component}/*.adoc"
	}
	outputDir "$buildDir/docs/ref-docs/"
	resources {
		from(sourceDir) {
			include "${language}/${component}/images/*"
		}
	}
	logDocuments = true

	outputs.upToDateWhen { false }
	outputOptions {
		backends = ["html5", "pdf"]
	}

	options doctype: 'book', eruby: 'erubis'
	attributes([
			icons: 'font',

			'highlightjs-theme': "${highlightjsTheme}",
			"highlightjsdir" : "http://docs.jcohy.com/js/highlight",
			"highlightjsTheme" : "github",
			"sourceHighlighter" : "highlight.js",
			"stylesdir": "$buildDir/docs/spring-docs-resources/css",
			"stylesheet" : "stylesheet.css",

			"resourceDir" : "./spring-docs-build/src/main/resources/",
			'sources-root':"${project.projectDir}/src",

			'spring-core-version': "5.2.4.RELEASE",
			"springVersion" : "5.2.4.RELEASE",
			'spring-version': "${springVersion}",
			'spring-framework-version' : "${springVersion}",

			"spring-integration-version" : "5.2.4.RELEASE",

			"springSecurityVersion" : "5.3.0.RELEASE",
			'spring-security-version':"${springSecurityVersion}",

			"springBootVersion" : "2.2.5.RELEASE",
			'spring-boot-version': "${springBootVersion}",

			"springDataJpaVersion" : "2.2.5.RELEASE",
			"springDataRedisVersion" : "2.2.5.RELEASE",
			"springDataRestVersion" : "3.2.5.RELEASE",
			"springDataCommonsVersion" : "2.2.5.RELEASE",
			"springRedisJpaVersion" : "3.2.5.RELEASE",

			"springHateoasVersion" : "1.0.4.RELEASE",

			"springCloudVersion" : "Hoxton SR3",

			"spring-webservices-version" : "3.0.8.RELEASE",

			"doc-root" : "http://docs.jcohy.com",
			"spring-boot-docs" : "https://docs.spring.io/spring-boot/docs/${springBootVersion}",
			"spring-docs-prefix" : "https://docs.spring.io/spring-framework/docs/",

	])
}